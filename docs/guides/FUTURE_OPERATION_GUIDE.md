# 今後の運用ガイド - Google API vs OpenAI API

株式会社エムエムインターナショナル 社内情報検索AIアプリ

---

## 📋 現在の状況と今後の方針

### ✅ 今回の対応（OpenAI APIでベクターストア作成）

**理由:**
- Google Gemini APIの無料枠では、埋め込みAPI（Embedding API）のクォータが非常に少ない
- 毎回起動時に埋め込みAPIを呼ぶと、すぐにクォータを超過してしまう
- **解決策:** ローカルでOpenAI APIを使ってベクターストアを一度作成し、それをデプロイする

**コスト:**
- 今回のベクターストア作成: 約1-2円（216チャンクの埋め込み）
- **重要:** この作業は一度だけ（データ更新時のみ再実行）

---

## 🎯 今後の運用戦略

### パターンA: Google Gemini API（無料） - 推奨

#### 構成
1. **ベクターストア（埋め込み）:** 事前作成済み（OpenAI APIで作成）
2. **LLM（チャット）:** Google Gemini API（無料）

#### メリット
- ✅ **完全に無料で運用可能**
- ✅ Google Gemini APIの無料枠は、**LLM（チャット）については十分に使える**
- ✅ 起動時に埋め込みAPIを呼ばないので、クォータ問題が発生しない

#### デメリット
- ❌ データ更新時には、ローカルでベクターストアを再作成してプッシュする必要がある

#### 運用フロー

**通常運用（毎日）:**
```
社員がアプリにアクセス
↓
ログイン
↓
質問を入力
↓
Google Gemini API（LLM）で回答生成 ← 無料枠で十分
↓
回答を表示
```

**データ更新時（月1回程度）:**
```
管理者がローカルで作業
↓
1. data/ フォルダにファイルを追加/更新
↓
2. create_vectorstore_openai.bat を実行（約1-2円）
↓
3. GitHubにプッシュ
↓
4. Streamlit Cloudで自動デプロイ
↓
完了（新しいデータで動作）
```

#### コスト
- **通常運用:** 完全無料
- **データ更新時:** 約1-2円/回（月1回なら月2円程度）
- **年間コスト:** 約24円

---

### パターンB: OpenAI API（有料） - 高頻度データ更新向け

#### 構成
1. **ベクターストア（埋め込み）:** 起動時に自動作成
2. **LLM（チャット）:** OpenAI API

#### メリット
- ✅ データ更新が自動的に反映される
- ✅ 管理が簡単（ローカル作業不要）
- ✅ 安定した性能

#### デメリット
- ❌ 有料（ただし少額）

#### コスト（推定）
- **埋め込みAPI:** 約$0.01-0.02/起動 = 1-2円/起動
  - 毎日再起動する場合: 約30-60円/月
  - データ更新時のみ再起動: 約1-2円/月
- **チャットAPI:** 約$0.001-0.01/質問 = 0.1-1円/質問
  - 100質問/日の場合: 約10-100円/日 = 300-3000円/月

#### 年間コスト
- **控えめな使用:** 約3,600円/年
- **活発な使用:** 約36,000円/年

---

## 💡 推奨する運用方針

### 【推奨】パターンA: Google Gemini API（無料）

**理由:**
1. ✅ **ほぼ無料で運用できる**（年間24円程度）
2. ✅ **Google Gemini APIの無料枠は、LLM（チャット）については十分**
   - 毎日1500リクエストまで（1リクエスト = 1往復の会話）
   - 社内アプリとしては十分すぎる
3. ✅ **ベクターストアを事前作成すれば、起動時に埋め込みAPIを呼ばない**
   - クォータ問題が発生しない
4. ✅ **データ更新は月1回程度なら、手動作業でも問題ない**

### 運用イメージ

#### 日常運用（社員）
- アプリにアクセス
- ログイン
- 質問を入力
- **Google Gemini API（無料）** で回答を受け取る
- 何も気にせず使える

#### データ更新（管理者、月1回程度）
1. ローカルで `data/` フォルダを更新
2. `create_vectorstore_openai.bat` を実行（約1-2円）
3. GitHubにプッシュ
4. Streamlit Cloudで自動デプロイ
5. 完了（約5-10分）

---

## 🔍 詳細比較

### Google Gemini API 無料枠の詳細

#### 使えるもの（十分に使える）
- ✅ **LLM（チャット）:** 毎日1500リクエスト
  - gemini-1.5-flash: 高速、無料
  - 社内アプリとしては十分

#### 使えないもの（制限が厳しい）
- ❌ **埋め込みAPI:** 非常に少ない（limit: 0と表示される）
  - 今回のように、216チャンクを埋め込もうとするとすぐに超過
  - **対策:** 事前にベクターストアを作成してデプロイ

---

## 📊 実用化に向けた判断基準

### Google Gemini API（無料）を選ぶ条件
- ✅ データ更新が **月1回程度**
- ✅ 質問数が **1日1500件以内**（十分すぎる）
- ✅ **コストを最小限に抑えたい**
- ✅ 管理者がローカルで作業できる

### OpenAI API（有料）を選ぶ条件
- ❌ データ更新が **毎日/毎週** など頻繁
- ❌ 質問数が **1日1500件以上**
- ✅ 管理を完全自動化したい
- ✅ 予算がある（月3,000-36,000円程度）

---

## 🎯 結論と推奨

### 【推奨】今後の運用方針

#### 1. ベクターストア
- **OpenAI APIで事前作成**（今回実施）
- データ更新時のみ再作成（月1回程度）
- コスト: 約1-2円/回 = 年間24円

#### 2. LLM（チャット）
- **Google Gemini API（無料）**
- 毎日1500リクエストまで無料
- コスト: 完全無料

#### 3. 総コスト
- **年間: 約24円**
- **実質無料**

---

## 📅 今後のデータ更新フロー

### データ更新が必要な場合（例: 新しいPDFを追加）

#### ステップ1: ローカルでデータを更新
```
data/ フォルダに新しいPDFを追加
```

#### ステップ2: ベクターストアを再作成
```
create_vectorstore_openai.bat をダブルクリック
↓
5-10分待つ
↓
完了（約1-2円）
```

#### ステップ3: GitHubにプッシュ
```
git add data/
git add vectorstore/
git commit -m "Update data and vectorstore"
git push origin main
```

#### ステップ4: Streamlit Cloudで自動デプロイ
```
GitHubにプッシュすると自動的に再デプロイ
↓
約3-5分待つ
↓
完了（新しいデータで動作）
```

---

## ⚠️ 注意事項

### Google Gemini APIの無料枠について

#### 使えるもの
- ✅ **LLM（チャット）:** gemini-1.5-flash
  - 毎日1500リクエスト
  - 十分に使える

#### 使えないもの
- ❌ **埋め込みAPI:** 非常に制限が厳しい
  - 今回のように、事前にベクターストアを作成することで回避

### データ更新頻度について

- **月1回程度:** 手動作業で問題なし（推奨）
- **毎日/毎週:** OpenAI APIの有料プランを検討

---

## 📞 サポート情報

### 内部サポート
- **メール:** ai-support@mm-international.co.jp

### データ更新手順の質問
- このドキュメントを参照
- `VECTORSTORE_SETUP_GUIDE.md` も参照

---

## 🔄 今回の作業（OpenAI APIでベクターストア作成）

次のセクションで、OpenAI APIを使ったベクターストア作成の具体的な手順を説明します。

---

**作成日:** 2025年12月13日  
**対象:** 株式会社エムエムインターナショナル  
**アプリ名:** mmi-ai-manager  
**バージョン:** 1.0



