# 🔒 セキュリティチェックリスト

## WEB公開前の必須確認事項

### 📋 このチェックリストについて

社内情報を含むアプリをWEB公開する前に、セキュリティリスクを最小限に抑えるための確認項目です。
**すべての項目にチェックが入るまで、本番公開しないでください。**

---

## ✅ レベル1: 基本セキュリティ（必須）

### 1.1 機密情報の除外

- [ ] `.gitignore` が正しく設定されている
- [ ] `.env` ファイルがGitに含まれていない
- [ ] `.streamlit/secrets.toml` がGitに含まれていない
- [ ] `data/` フォルダがGitに含まれていない
- [ ] APIキーがコード内に直接記述されていない

**確認方法**:
```bash
# Gitの追跡対象を確認
git status

# 履歴に機密情報が含まれていないか確認
git log --all --full-history --oneline -- .env
git log --all --full-history --oneline -- data/
```

### 1.2 APIキーの管理

- [ ] Google Gemini APIキーが環境変数で管理されている
- [ ] APIキーが漏洩していない（GitHubで検索して確認）
- [ ] Streamlit Cloudの Secrets に正しく設定されている

**確認方法**:
```bash
# ローカル環境
echo %GOOGLE_API_KEY%  # Windows
# または
echo $GOOGLE_API_KEY   # Mac/Linux

# APIキーがコードに含まれていないか確認
grep -r "AIzaSy" .
grep -r "sk-proj" .
```

### 1.3 リポジトリの公開設定

- [ ] GitHubリポジトリが **Private** に設定されている
- [ ] 不要なコラボレーターを削除している

**確認方法**:
```
GitHub → リポジトリ → Settings → General
→ 「Public」ではなく「Private」になっているか確認
```

---

## ✅ レベル2: アクセス制御（推奨）

### 2.1 Streamlit Cloudのアクセス制限

以下のいずれかの方法でアクセスを制限してください：

**オプションA: メールドメイン制限**
- [ ] 社内ドメイン（@mm-international.co.jp）のみアクセス可能に設定

**オプションB: 招待制**
- [ ] アクセス可能なメールアドレスを個別に登録

**オプションC: パスワード認証**
- [ ] アプリ内認証機能を有効化
- [ ] 強固なパスワードを設定
- [ ] パスワードを社内で安全に共有

**設定方法**:
```
Streamlit Cloud → アプリ → Settings → Sharing
```

### 2.2 認証機能の設定

パスワード認証を使用する場合：

- [ ] `auth.py` が正しくインポートされている
- [ ] `main.py` に認証チェックが実装されている
- [ ] Secrets に `[auth]` セクションが設定されている
- [ ] パスワードが十分に複雑（12文字以上推奨）

**Secrets 設定例**:
```toml
[auth]
password = "Your_Secure_P@ssw0rd_Here_2024"
```

---

## ✅ レベル3: データ保護（重要）

### 3.1 社内データの取り扱い

- [ ] 本番環境に配置するデータファイルを厳選している
- [ ] 機密度の高いファイルは除外している
- [ ] テスト用のサンプルデータで動作確認済み
- [ ] データファイルの定期的な見直し体制がある

### 3.2 ログとエラーメッセージ

- [ ] エラーメッセージに機密情報が含まれていない
- [ ] ログファイルがGitに含まれていない（`.gitignore` で除外）
- [ ] デバッグモードが無効化されている

---

## ✅ レベル4: API制限管理（運用）

### 4.1 Google Gemini API

- [ ] 無料版の制限を理解している
  - 1日1500リクエスト（約750回の質問）
  - 1分15リクエスト
- [ ] データファイル数を調整済み（推奨: 25ファイル以下）
- [ ] 制限超過時の対応手順を決めている

### 4.2 使用量のモニタリング

- [ ] [Google AI Studio](https://aistudio.google.com/) で使用量を定期確認
- [ ] 異常なアクセスがないか監視体制がある

---

## ✅ レベル5: 継続的セキュリティ（保守）

### 5.1 定期的な確認

- [ ] 月1回: アクセスログの確認
- [ ] 月1回: パスワードの変更（認証を使用している場合）
- [ ] 四半期1回: アクセス権限の見直し
- [ ] 四半期1回: データファイルの見直し

### 5.2 アップデート管理

- [ ] 依存パッケージの脆弱性チェック
- [ ] Streamlitの新バージョン確認
- [ ] LangChainの新バージョン確認

**確認コマンド**:
```bash
# 依存パッケージの脆弱性チェック
pip list --outdated

# GitHubのDependabotを有効化
# Settings → Security → Dependabot → Enable
```

### 5.3 インシデント対応

- [ ] APIキー漏洩時の対応手順を文書化
- [ ] 不正アクセス発見時の連絡先を決定
- [ ] データ削除手順の確認

---

## 🚨 緊急時の対応

### APIキーが漏洩した場合

1. **即座に実行**:
   ```bash
   # Google AI Studio でAPIキーを無効化
   # https://aistudio.google.com/app/apikey
   
   # 新しいAPIキーを生成
   
   # Streamlit Cloud の Secrets を更新
   ```

2. **確認事項**:
   - [ ] GitHubの履歴から機密情報を完全削除
   - [ ] 新しいAPIキーで動作確認
   - [ ] 漏洩経路の特定と再発防止

### 不正アクセスが疑われる場合

1. **即座に実行**:
   ```bash
   # アプリを一時停止
   Streamlit Cloud → Settings → Pause app
   
   # アクセスログの確認
   # 不審なアクセスの調査
   ```

2. **対応**:
   - [ ] パスワード変更
   - [ ] アクセス制限の強化
   - [ ] 関係者への通知

---

## 📊 セキュリティスコア

チェックした項目数に応じて、セキュリティレベルを評価してください：

| チェック項目数 | セキュリティレベル | 判定 |
|--------------|------------------|------|
| 30-35項目 | 🟢 **高** | WEB公開OK |
| 20-29項目 | 🟡 **中** | 改善推奨 |
| 10-19項目 | 🟠 **低** | 改善必須 |
| 0-9項目 | 🔴 **危険** | 公開禁止 |

---

## 🎯 最低限の公開要件

**以下の項目は必須です。1つでも欠けている場合は公開しないでください。**

1. ✅ GitHubリポジトリがPrivate
2. ✅ APIキーが環境変数で管理
3. ✅ `.env` と `data/` が `.gitignore` に含まれる
4. ✅ Streamlit Cloudでアクセス制限設定
5. ✅ 機密データを厳選して配置

---

## 📚 参考資料

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Streamlit Security](https://docs.streamlit.io/knowledge-base/deploy/authentication)
- [Google Cloud Security Best Practices](https://cloud.google.com/security/best-practices)

---

## ✅ 最終確認

WEB公開前に、このチェックリストを印刷またはPDF化し、
すべての項目にチェックを入れてから公開してください。

**確認者**: ________________  
**確認日**: ________________  
**承認者**: ________________  

---

**セキュリティは継続的な取り組みです。定期的にこのチェックリストを見直してください。**

